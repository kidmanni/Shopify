
{% assign number_of_related_products_to_show = 2 %}
{% assign image_size = 'medium' %}
{% assign heading = 'Other fine products' %}
{% assign current_id = product.id %}
{% if product.tags.size > 0 %}
  <h3>{{ heading }}</h3>
  {% assign counter = '' %}
  <ul class="related-products">
    {% paginate collections.all.products by 1000 %}
    {% for prod in collections.all.products %}
      {% if prod.tags contains product.tags.first and counter.size < number_of_related_products_to_show and current_id != prod.id %} 
      <li>
        <div class="image">
          <a href="{{ prod.url | within: collections.all }}" title="{{ prod.title | escape }}">
            {{ prod.featured_image | product_img_url: image_size | img_tag }}
          </a>
        </div>
        <h3>
          <a href="{{ prod.url | within: collections.all }}" title="{{ prod.title | escape }}">{{ prod.title }}</a>
        </h3>
        <strong>{{ prod.price | money }}</strong>
      </li>
      {% capture counter %}{{ counter }}*{% endcapture %}
      {% endif %}
    {% endfor %}
    {% endpaginate %}
  </ul>
{% endif %}